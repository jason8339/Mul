# å‹•æ…‹ç¢°æ’ç³»çµ± - å¯¦ç¾ç¸½çµ

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

**å‰‘åªåœ¨é£è¡Œæ—¶æ‰å¯ç”¨ç¢°æ’æ£€æµ‹**

è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–è®¾è®¡ï¼Œç¡®ä¿ï¼š
- âœ… å‰‘åœ¨æ‰‹ä¸Šæ—¶ï¼š**æ— ç¢°æ’ç»„ä»¶** â†’ ä¸ä¼šå¹²æ‰°æ‰‹éƒ¨è¿½è¸ª
- âœ… å‰‘é£è¡Œæ—¶ï¼š**å¯ç”¨ç¢°æ’ç»„ä»¶** â†’ å¯ä»¥æ£€æµ‹éšœç¢ç‰©
- âœ… å‰‘å›åˆ°æ‰‹ä¸Šï¼š**ç§»é™¤ç¢°æ’ç»„ä»¶** â†’ æ¢å¤å¹²å‡€çŠ¶æ€

---

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. ç§»é™¤é™æ€ç¢°æ’åˆå§‹åŒ–

**ä¹‹å‰çš„é—®é¢˜**ï¼š
```swift
// HandTrackingSystem.swiftï¼ˆæ—§ä»£ç ï¼‰
// âŒ å‰‘ä¸€åŠ è½½å°±æ·»åŠ ç¢°æ’ç»„ä»¶
if !Self.swordCollisionInitialized {
    let collision = CollisionComponent(...)
    sword.components.set(collision)
}
```

**ç°åœ¨çš„åšæ³•**ï¼š
```swift
// HandTrackingSystem.swift:38ï¼ˆæ–°ä»£ç ï¼‰
// âœ… åªæŸ¥æ‰¾å‰‘ï¼Œä¸æ·»åŠ ç¢°æ’
private func findSwordInScene(scene: RealityKit.Scene) -> Entity? {
    guard let sword = scene.findEntity(named: "Sword_No1") else {
        return nil
    }
    return sword  // ç›´æ¥è¿”å›ï¼Œä¸æ·»åŠ ä»»ä½•ç»„ä»¶
}
```

---

### 2. å‘å°„æ—¶æ·»åŠ ç¢°æ’ç»„ä»¶

**ä½ç½®**: HandTrackingSystem.swift:260-266

```swift
// åˆ¤æ–­æ˜¯å¦å‘å°„
if swordComponent.shouldLaunch() {
    // ... è®¾ç½®é£è¡ŒçŠ¶æ€ ...

    // â­ å…³é”®ï¼šå‘å°„æ—¶æ‰æ·»åŠ ç¢°æ’ç»„ä»¶
    let collision = CollisionComponent(
        shapes: [.generateBox(size: [0.05, 0.05, 0.8])],
        mode: .trigger
    )
    swordEntity.components.set(collision)
    print("âœ… é£›è¡Œä¸­ï¼šå•Ÿç”¨ç¢°æ’æª¢æ¸¬")
}
```

**è§¦å‘æ—¶æœº**: å½“ `shouldLaunch()` è¿”å› trueï¼ˆæ£€æµ‹åˆ°è¶³å¤Ÿçš„æŒ¥åŠ¨é€Ÿåº¦ï¼‰

---

### 3. åœæ­¢é£è¡Œæ—¶ç§»é™¤ç¢°æ’ç»„ä»¶

å®ç°äº†**3ä¸ªåœæ­¢é£è¡Œåœºæ™¯**ï¼Œæ¯ä¸ªéƒ½ä¼šç§»é™¤ç¢°æ’ç»„ä»¶ï¼š

#### åœºæ™¯Aï¼šç¢°æ’åœæ­¢
**ä½ç½®**: FlyingSwordSystem.swift:21-32

```swift
if checkCollision(entity: entity, component: &swordComponent, ...) {
    swordComponent.resetFlightState()

    // â­ å…³é”®ï¼šç§»é™¤ç¢°æ’ç»„ä»¶
    entity.components.remove(CollisionComponent.self)
    print("ğŸ’¥ é£å‰‘ç¢°æ’ï¼åœæ­¢é£è¡Œï¼Œç¦ç”¨ç¢°æ’æª¢æ¸¬")
}
```

**è§¦å‘æ¡ä»¶**: å‰‘å°–å°„çº¿æ£€æµ‹åˆ°éšœç¢ç‰©

---

#### åœºæ™¯Bï¼šè¶…æ—¶åœæ­¢
**ä½ç½®**: FlyingSwordSystem.swift:53-60

```swift
if swordComponent.elapsedTime > swordComponent.config.maxFlyingTime {
    swordComponent.resetFlightState()

    // â­ å…³é”®ï¼šç§»é™¤ç¢°æ’ç»„ä»¶
    entity.components.remove(CollisionComponent.self)
    print("âœ… é£›åŠé£›è¡ŒçµæŸï¼ˆè¶…éæœ€å¤§é£›è¡Œæ™‚é–“ï¼‰ï¼Œç¦ç”¨ç¢°æ’æª¢æ¸¬")
}
```

**è§¦å‘æ¡ä»¶**: é£è¡Œæ—¶é—´è¶…è¿‡ `maxFlyingTime`ï¼ˆé»˜è®¤10000ç§’ï¼‰

---

#### åœºæ™¯Cï¼šè‡ªåŠ¨è¿”å›åœæ­¢
**ä½ç½®**: FlyingSwordSystem.swift:135-142

```swift
if distance < 0.015 { // 1.5 å…¬åˆ†å†…
    component.resetFlightState()

    // â­ å…³é”®ï¼šç§»é™¤ç¢°æ’ç»„ä»¶
    entity.components.remove(CollisionComponent.self)
    print("âœ… é£›åŠå·²ç¶“è¿”å›åˆ°æ‰‹æŒ‡ä½ç½®ï¼Œç¦ç”¨ç¢°æ’æª¢æ¸¬")
    return
}
```

**è§¦å‘æ¡ä»¶**: å‰‘è‡ªåŠ¨è¿”å›åˆ°å³æ‰‹é£ŸæŒ‡æŒ‡å°–1.5cmå†…

---

## ğŸ”„ å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

```
1. åˆå§‹çŠ¶æ€
   â””â”€> å‰‘è·Ÿéšæ‰‹æŒ‡
   â””â”€> æ— ç¢°æ’ç»„ä»¶ âœ…

2. æ£€æµ‹æŒ¥åŠ¨
   â””â”€> æ”¶é›†ä½ç½®æ ·æœ¬
   â””â”€> è®¡ç®—é€Ÿåº¦

3. é€Ÿåº¦è¾¾æ ‡ â†’ å‘å°„ï¼
   â””â”€> isFlying = true
   â””â”€> æ·»åŠ  CollisionComponent â­
   â””â”€> å‰‘å¼€å§‹é£è¡Œ

4. é£è¡Œä¸­
   â””â”€> æ¯å¸§æ£€æµ‹ç¢°æ’ï¼ˆä½¿ç”¨å‰‘å°–ä½ç½®ï¼‰
   â””â”€> é¥æ§è¾“å…¥
   â””â”€> è‡ªåŠ¨è¿”å›æ£€æµ‹

5. åœæ­¢é£è¡Œï¼ˆä¸‰ç§æ–¹å¼ä¹‹ä¸€ï¼‰
   â”œâ”€> A. ç¢°æ’éšœç¢ç‰©
   â”œâ”€> B. è¶…è¿‡æœ€å¤§é£è¡Œæ—¶é—´
   â””â”€> C. è‡ªåŠ¨è¿”å›åˆ°æ‰‹æŒ‡

6. å›åˆ°è·Ÿéšæ¨¡å¼
   â””â”€> isFlying = false
   â””â”€> ç§»é™¤ CollisionComponent â­
   â””â”€> å‰‘è·Ÿéšæ‰‹æŒ‡
```

---

## ğŸ¨ ä¼˜åŠ¿

### 1. **æ€§èƒ½ä¼˜åŒ–** âš¡
- å‰‘åœ¨æ‰‹ä¸Šæ—¶ä¸å‚ä¸ç¢°æ’ç³»ç»Ÿ
- å‡å°‘ä¸å¿…è¦çš„ç¢°æ’æ£€æµ‹å¼€é”€

### 2. **é¿å…è¯¯è§¦** ğŸš«
- å‰‘åœ¨æ‰‹ä¸Šæ—¶ä¸ä¼šå’Œæ‰‹éƒ¨å…³èŠ‚ç¢°æ’
- ä¸ä¼šæ„å¤–è§¦å‘ç¢°æ’äº‹ä»¶

### 3. **æ¸…æ™°çš„çŠ¶æ€ç®¡ç†** ğŸ“Š
- ç¢°æ’ç»„ä»¶çš„å­˜åœ¨ = å‰‘æ­£åœ¨é£è¡Œ
- å¯ä»¥é€šè¿‡æ£€æŸ¥ `CollisionComponent` å¿«é€Ÿåˆ¤æ–­çŠ¶æ€

### 4. **è°ƒè¯•å‹å¥½** ğŸ›
- å¯ç”¨/ç¦ç”¨ç¢°æ’æ—¶éƒ½æœ‰æ—¥å¿—è¾“å‡º
- å®¹æ˜“è¿½è¸ªç¢°æ’ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

---

## ğŸ“Š é¢„æœŸæ—¥å¿—è¾“å‡º

### æ­£å¸¸æµç¨‹ï¼š

```
1. å¯åŠ¨åº”ç”¨
   ğŸ” å¼€å§‹ä¸ºåœºæ™¯æ·»åŠ ç¢°æ’ç»„ä»¶...
   ğŸš« è·³è¿‡æ‰‹éƒ¨å…³èŠ‚: [åç§°]
   ğŸš« è·³è¿‡å‰‘å®ä½“: Sword_No1
   âœ… åœºæ™¯ç¢°æ’æ·»åŠ å®Œæˆï¼šå…±æ‰«æ X ä¸ªå®ä½“ï¼Œæ·»åŠ  Y ä¸ªç¢°æ’ä½“

2. å‘å°„é£å‰‘
   âœ… é€Ÿåº¦è¾¾æ ‡: 25.34cm/sï¼Œå‡†å¤‡å‘å°„ï¼
   ğŸš€ å‘å°„é£å‰‘ï¼é€Ÿåº¦: XXX cm/sï¼Œé‡é‡: 0.5 kg
   âœ… é£›è¡Œä¸­ï¼šå•Ÿç”¨ç¢°æ’æª¢æ¸¬  â­

3. ç¢°æ’åœæ­¢
   ğŸ’¥ æ£€æµ‹åˆ°ç¢°æ’: [ç‰©ä½“åç§°] è·ç¦»: XX.XXcm
   ğŸ’¥ é£å‰‘ç¢°æ’ï¼åœæ­¢é£è¡Œï¼Œç¦ç”¨ç¢°æ’æª¢æ¸¬  â­
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥ç¢°æ’ç»„ä»¶çŠ¶æ€

åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ æ­¤ä»£ç æ£€æŸ¥å‰‘æ˜¯å¦æœ‰ç¢°æ’ç»„ä»¶ï¼š

```swift
if let sword = scene.findEntity(named: "Sword_No1") {
    let hasCollision = sword.components.has(CollisionComponent.self)
    let isFlying = sword.components[FlyingSwordComponent.self]?.isFlying ?? false

    print("å‰‘çŠ¶æ€: isFlying=\(isFlying), hasCollision=\(hasCollision)")

    // æ­£å¸¸æƒ…å†µä¸‹ï¼šisFlying == hasCollision
    if isFlying != hasCollision {
        print("âš ï¸ çŠ¶æ€ä¸ä¸€è‡´ï¼")
    }
}
```

### éªŒè¯ç¢°æ’ç»„ä»¶è¢«æ­£ç¡®ç§»é™¤

å¦‚æœç¢°æ’ç»„ä»¶æ²¡æœ‰è¢«æ­£ç¡®ç§»é™¤ï¼Œä¼šçœ‹åˆ°ï¼š
```
âš ï¸ çŠ¶æ€ä¸ä¸€è‡´ï¼isFlying=false, hasCollision=true
```

è¿™è¡¨ç¤ºæŸä¸ªåœæ­¢é£è¡Œçš„ä»£ç è·¯å¾„å¿˜è®°ç§»é™¤ç¢°æ’ç»„ä»¶ã€‚

---

## ğŸš€ æœªæ¥æ‰©å±•

å¦‚æœéœ€è¦æ›´å¤æ‚çš„ç¢°æ’è¡Œä¸ºï¼Œå¯ä»¥ï¼š

### 1. ä¸åŒçš„ç¢°æ’æ¨¡å¼

```swift
// å‘å°„æ—¶æ ¹æ®é€Ÿåº¦é€‰æ‹©ç¢°æ’æ¨¡å¼
let speed = length(velocity)
let collisionMode: CollisionComponent.Mode = speed > 2.0 ? .default : .trigger

let collision = CollisionComponent(
    shapes: [.generateBox(size: [0.05, 0.05, 0.8])],
    mode: collisionMode
)
```

### 2. æ¸è¿›å¼ç¢°æ’å¯ç”¨

```swift
// å‘å°„åå»¶è¿Ÿå¯ç”¨ç¢°æ’ï¼ˆé¿å…å’Œæ‰‹éƒ¨ç¢°æ’ï¼‰
Task {
    try? await Task.sleep(nanoseconds: 100_000_000)  // 0.1ç§’å
    if swordComponent.isFlying {
        swordEntity.components.set(collision)
    }
}
```

### 3. ç¢°æ’è¿‡æ»¤

```swift
// æ ¹æ®é£è¡Œé˜¶æ®µä½¿ç”¨ä¸åŒçš„ CollisionFilter
let filter = swordComponent.elapsedTime < 1.0
    ? CollisionFilter(group: .sword, mask: .environment)  // å‰1ç§’åªç¢°ç¯å¢ƒ
    : CollisionFilter(group: .sword, mask: .all)          // ä¹‹åç¢°æ‰€æœ‰
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿ç§»é™¤ç¢°æ’ç»„ä»¶**
   - æ‰€æœ‰è°ƒç”¨ `resetFlightState()` çš„åœ°æ–¹éƒ½è¦ç§»é™¤ç¢°æ’ç»„ä»¶
   - å¦åˆ™ä¼šå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

2. **æ€§èƒ½è€ƒè™‘**
   - é¢‘ç¹æ·»åŠ /ç§»é™¤ç»„ä»¶æœ‰å°å¼€é”€
   - ä½†æ¯”æŒç»­ç¢°æ’æ£€æµ‹å¼€é”€å°å¾—å¤š

3. **è°ƒè¯•æ—¶**
   - å¯ä»¥ä¿æŒç¢°æ’ç»„ä»¶ä¸€ç›´å­˜åœ¨ï¼ˆæ³¨é‡Šæ‰ç§»é™¤ä»£ç ï¼‰
   - æ–¹ä¾¿ä½¿ç”¨ç‰©ç†è°ƒè¯•å·¥å…·æŸ¥çœ‹ç¢°æ’ç›’

---

## âœ… æ€»ç»“

åŠ¨æ€ç¢°æ’ç³»ç»Ÿé€šè¿‡åœ¨é£è¡Œæ—¶æ‰å¯ç”¨ç¢°æ’æ£€æµ‹ï¼Œå®ç°äº†ï¼š

- ğŸ¯ **ç²¾ç¡®**: åªåœ¨éœ€è¦æ—¶æ£€æµ‹ç¢°æ’
- âš¡ **é«˜æ•ˆ**: é¿å…ä¸å¿…è¦çš„ç¢°æ’è®¡ç®—
- ğŸ› **å¯é **: æ¸…æ™°çš„çŠ¶æ€ç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸ
- ğŸš« **å®‰å…¨**: é¿å…å’Œæ‰‹éƒ¨å…³èŠ‚è¯¯ç¢°æ’

è¿™æ˜¯ä¸€ä¸ªç®€å•ä½†æœ‰æ•ˆçš„ä¼˜åŒ–ï¼Œè®©ç¢°æ’ç³»ç»Ÿæ›´åŠ å¯æ§å’Œå¯é¢„æµ‹ï¼
